<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibe Guide</title>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/@strudel/web@1.0.3"></script>

    <style>
      #audioToggle {
        position: fixed;
        top: 20px;
        right: calc(2.6vw + 20px);
        font-size: 32px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        z-index: 1001;
        -webkit-tap-highlight-color: transparent;
      }

      @media (max-width: 768px) {
        #audioToggle {
          top: 10px;
          right: 10px;
          font-size: 28px;
          padding: 8px;
        }
      }

      @media (max-width: 480px) {
        #audioToggle {
          top: 8px;
          right: 8px;
          font-size: 24px;
          padding: 6px;
        }
      }
    </style>

    <button id="audioToggle">ðŸ”‡</button>

    <script src="https://unpkg.com/@strudel/web@1.0.3"></script>

    <script>
      const baseCDN = "https://strudel.b-cdn.net";

      initStrudel({
        prebake: () => {
          samples("github:tidalcycles/dirt-samples");
          samples("github:tidalcycles/808");
          samples("github:tidalcycles/909");
          samples("github:eddyflux/crate");
          samples(`${baseCDN}/piano.json`, `${baseCDN}/piano/`, {
            prebake: true,
          });
          samples(`${baseCDN}/vcsl.json`, `${baseCDN}/VCSL/`, {
            prebake: true,
          });
          samples(
            `${baseCDN}/tidal-drum-machines.json`,
            `${baseCDN}/tidal-drum-machines/machines/`,
            {
              prebake: true,
              tag: "drum-machines",
            }
          );
          samples(`${baseCDN}/uzu-drumkit.json`, `${baseCDN}/uzu-drumkit/`, {
            prebake: true,
            tag: "drum-machines",
          });
          samples(
            `${baseCDN}/uzu-wavetables.json`,
            `${baseCDN}/uzu-wavetables/`,
            {
              prebake: true,
            }
          );
          samples(`${baseCDN}/mridangam.json`, `${baseCDN}/mrid/`, {
            prebake: true,
            tag: "drum-machines",
          });
          console.log("prebake loaded===-=--=");
        },
      });

      let isPlaying = false;
      const toggleBtn = document.getElementById("audioToggle");

      toggleBtn.addEventListener("click", () => {
        if (isPlaying) {
          hush();
          toggleBtn.textContent = "ðŸ”‡";
          isPlaying = false;
        } else {
          playMusic();
          toggleBtn.textContent = "ðŸ”Š";
          isPlaying = true;
        }
      });

      function playMusic() {
        stack(
          note("[c1 ~ eb1 ~ g1 ~ bb1 ~]")
            .release(0.3)
            .s("sawtooth")
            .lpf(320)
            .lpq(4)
            .room(0.3)
            .postgain(1.1)
            .gain("[.4 1@3]*2")
            .mask("<0@8 1@8 1@8 1@8 0>"),

          note("c1!2")
            .release(1.2)
            .s("sawtooth")
            .lpf(240)
            .lpq(3)
            .room(0.25)
            .postgain(1.6)
            .mask("<0@8 0@8 0@8 0@8 1>"),

          note("[c3 eb3 g3 bb3]*2")
            .release(0.2)
            .s("square")
            .lpf(sine.range(800, 1800).slow(10))
            .room(0.5)
            .postgain("<0.6 0.6 0.6 0.6 0.3>")
            .superimpose((x) => x.delay(0.5).postgain(0.4))
            .mask("<1@8 1@8 1@8 1@8 1>"),

          note("[c4 g4 eb4 bb4]*4")
            .release(0.1)
            .s("sawtooth")
            .lpf(sine.range(1000, 2200).slow(8))
            .room(0.6)
            .postgain("<0.45 0.45 0.45 0.45 0.25>")
            .superimpose((x) => x.delay(0.375).postgain(0.3))
            .mask("<0@8 1@8 1@8 1@8 1>"),

          note("[c2 eb2 g2 bb2]")
            .release(0.8)
            .s("triangle")
            .lpf(sine.range(600, 1200).slow(16))
            .room(0.7)
            .postgain(0.3),

          stack(
            s("bd!4")
              .mask("<0@8 0@8 1@8 1@8 1>")
              .postgain("<1.3 1 1 1 1.3>"),

            s("~ sd ~ sd").mask("<0@8 1@8 1@8 1@8 1>"),

            s("hh*8")
              .gain(saw.mul(saw.fast(2)))
              .postgain(0.8)
              .mask("<0@8 1@8 1@8 1@8 0>")
          ).bank("RolandTR909")
        ).play();
      }
    </script>

    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
